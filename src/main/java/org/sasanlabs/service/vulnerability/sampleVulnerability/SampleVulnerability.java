package org.sasanlabs.service.vulnerability.sampleVulnerability;

import org.sasanlabs.internal.utility.LevelConstants;
import org.sasanlabs.internal.utility.Variant;
import org.sasanlabs.internal.utility.annotations.AttackVector;
import org.sasanlabs.internal.utility.annotations.VulnerableAppRequestMapping;
import org.sasanlabs.internal.utility.annotations.VulnerableAppRestController;
import org.sasanlabs.service.vulnerability.bean.GenericVulnerabilityResponseBean;
import org.sasanlabs.vulnerability.types.VulnerabilityType;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * This is a sample vulnerability for helping developers in adding a new Vulnerability for
 * VulnerableApp
 *
 * @author KSASAN preetkaran20@gmail.com
 */
/**
 * {@code VulnerableAppRestController} annotation is similar to {@link
 * org.springframework.stereotype.Controller} Annotation
 */
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.bind.annotation.RequestMapping;

@RestController
@RequestMapping("/VulnerableApp/SampleVulnerability")
@VulnerableAppRestController(
        descriptionLabel = "SAMPLE_VULNERABILITY",
        value = "SampleVulnerability")
public class SampleVulnerability {

    /**
     * {@code AttackVector} annotation is used to create the Hints section in the User Interface.
     * This annotation can be mentioned multiple times in case the same vulnerability level
     */
    @AttackVector(
            vulnerabilityExposed = VulnerabilityType.SAMPLE_VULNERABILITY,
            description = "SAMPLE_VULNERABILITY_USER_INPUT_HANDLING_INJECTION",
            payload = "NOT_APPLICABLE")
    @RequestMapping(path = "/LEVEL_1", params = "name")
    /**
     * This annotation is similar to {@link RequestMapping} SpringBoot annotation. It will map the
     * endpoint to /VulnerableApp/SampleVulnerability/LEVEL_1 where LEVEL_1 is coming from the value
     * parameter.
     */
    @VulnerableAppRequestMapping(
            value = LevelConstants.LEVEL_1,
            htmlTemplate = "LEVEL_1/SampleVulnerability")
    public GenericVulnerabilityResponseBean<String> sampleUnsecuredLevel(
            @RequestParam("name") String key) {
        /** Add Business logic here */
        return new GenericVulnerabilityResponseBean<>("Not Implemented", true);
    }

    /** For secured level there is no need for {@link AttackVector} annotation. */
    @RequestMapping(path = "/LEVEL_2", params = "name")
    @VulnerableAppRequestMapping(
            value = LevelConstants.LEVEL_2,
            htmlTemplate = "LEVEL_1/SampleVulnerability",
            variant = Variant.SECURE)
    public GenericVulnerabilityResponseBean<String> sampleSecuredLevel(
            @RequestParam("name") String key) {
        /** Add Business logic here */
        return new GenericVulnerabilityResponseBean<>("Not Implemented", true);
    }
}
